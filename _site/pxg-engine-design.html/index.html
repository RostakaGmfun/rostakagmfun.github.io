<!DOCTYPE html>
<html lang="en-us">

  <head>
  <meta charset="UTF-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <!-- Google Analytics -->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-36064200-2', 'auto');
  ga('send', 'pageview');

  </script>

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      My own game engine or why I have given up writing it &middot; Awesome Programmer
    
  </title>

  <meta name="description" content="In this article I will highlight main problems of my own game engine and explain why good software design is so important."/>
  <meta name="keywords" content="c++, code design, game engine"/>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="Awesome Programmer" href="/atom.xml">
</head>


  <body class="sidebar-overlay theme-base-0c">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-avatar">
     <img src="/public/pixelavatar.png">
  </div>
  <div class="sidebar-item">
    <p>CEO of the universe. Pissing on your heads.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Home</a>

    

    
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
    <a class="sidebar-nav-item" href="https://github.com/RostakaGmfun/rostakagmfun.github.io">GitHub project</a>
  </nav>
  <div class ="sidebar-item">
          <a href="https://github.com/RostakaGmfun" target="_blank"><img src="/public/gh-mark.png"></a>GitHub
  </div>
  <div class ="sidebar-item">
          <a href="https://twitter.com/RostakaGmfun" target="_blank"><img src="/public/twitter512.png" width=36 height=36 ></a>Twitter
  </div>
  <div class="sidebar-item">
    <p>
      &copy; 2014-2015. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Awesome Programmer</a>
            <small>Code, cookies, universe</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <article class="post">
  <h1 class="post-title">My own game engine or why I have given up writing it</h1>
  <time datetime="2014-10-21T00:00:00+03:00" class="page-date">21 Oct 2014</time>
  <h2 id='introduction'>Introduction</h2>

<p>I have been writing my own game <a href='https://github.com/RostakaGmfun/PixelGearEngine'>engine</a> since February till August this year. The reason why I have given up writing it is self-evident if you look at it&#8217;s code. Most of all, the engine suffers from bad OO design. As the size of code has grown, it became really painful to add new features and fix bugs. The main reasons for why this hell happened are:</p>

<ul>
<li>I haven&#8217;t known much about OO patterns</li>

<li>I was writing 3D engine for the first time, that is why I have concentrated on features rather than on clear code design</li>
</ul>

<p>Things changed rapidly when I have started reading <a href='http://www.headfirstlabs.com/books/hfdp/'>Head First: Design Patterns</a>. I understood the mistakes I have made while writing my engine and in this article I&#8217;m going to highlight some of the biggest mistakes in PixelGear Engine.</p>

<h2 id='the_main_class'>The main class</h2>

<p>Though I was targeting to eventually develop cross platform engine, it&#8217;s code design really wasn&#8217;t ready for this. First of all, the whole window and context management boilerplate were encapsulated in single <code>pxgEngine</code> class. Getting user input, creating window and context, counting frames per second made the <code>pxgEngine</code> class a real mess. Furthermore, the HUD system was also somewhat dependent on <code>pxgEngine</code> class, since you should call <code>pxgEngine::setHUDManager()</code> to enable HUD rendering.</p>
<script src='http://gist-it.appspot.com/https://github.com/RostakaGmfun/PixelGearEngine/blob/master/include/PXG.h?slice=30:74' />
<h2 id='node_system'>Node system</h2>

<p>By initial concept both 3D objects and scenes in my engine should inherit an abstract <code>pxgNode</code> class. This class should provide parent-child relations management, spatial transformations and object name handling. In addition, <code>pxgNode</code> class included pure virtual functions for updating, rendering, and destroying nodes. However, this system was implemented badly at the beginning and was totally broken as the number of objects has grown. One of the numerous problems of <code>pxgNode</code> was <code>UpdateTransformation()</code> function. It updates the world matrix from scale, translation and rotation vectors and is meant to be called in <code>Update()</code> pure virtual function. Now I can say, that such system should have been implemented with <a href='http://en.wikipedia.org/wiki/Template_method_pattern'>Template Method Pattern</a>.</p>
<script src='http://gist-it.appspot.com/https://github.com/RostakaGmfun/PixelGearEngine/blob/master/include/pxgNode.h?slice=14:44' />
<h2 id='world'>World</h2>

<p>At the beginning the world system was meant to be a special scene, but later it turned into rather big class with many methods and HAS-A relationships with other engine classes. The inheritance of <code>pxgWorld</code> from <code>pxgNode</code> was not required at all. <code>pxgWorld</code> managed physics, background, post-processing and object picking systems completely or partially on its own. In fact, this class needed complete redesign most of all among other engine classes.</p>
<script src='http://gist-it.appspot.com/https://github.com/RostakaGmfun/PixelGearEngine/blob/master/include/pxgWorld.h?slice=26:62' />
<h2 id='pxgobject_and_friends'>pxgObject and friends</h2>

<p>This class was used to render both 3D models an 3D sprites; it also used its own system for child mesh management (despite inheriting from <code>pxgNode</code>. In fact, <code>pxgNode</code>s parent-child system was not used by any class in the engine). Although <code>pxgObject</code> used high-level engine classes for shader, buffer and texture management, the <code>pxgObject.cpp</code> contains direct OpenGL calls (to manage vertex array and actually render the object). You should not be a professional programmer to note that <code>pxgObject</code> system was completely wrong. <script src='http://gist-it.appspot.com/https://github.com/RostakaGmfun/PixelGearEngine/blob/master/src/pxgObject.cpp?slice=254:344' style='overflow:auto' /> As there were no higher-level abstractions for vertex arrays and draw calls, the same code should be written again and again every time you implement new renderable object (e.g. terrain, HUD object, particle system and so on).</p>

<h2 id='os_abstractions_and_math_library'>OS abstractions and math library</h2>

<p>In short, there are no OS abstractions in PixelGear. I thought I don&#8217;t need them. In fact, I didn&#8217;t need them while deploying the engine only on my development system (Linux). As for the math library, which is really important part of 3D rendering system, I have used really robust <a href='http://glm.g-truc.net/'>GLM</a> - OpenGL Math Library, which mimics GLSL syntax and is really fast. However, in my engine only the small part of this great library was used. As <code>GLM</code> used C++ templates intensively, it slowed down compilation of the engine. That is why it is good idea to write your own math library to fit particular purposes. The same with standard C++ library - it slows things down both at compile time and runtime - that is why it is good to write your own containers and string classes.</p>

<h2 id='engine_features'>Engine Features</h2>

<p>Even though PixelGear engine suffered from bad OO design, it has some features. Here is full feature list of my engine</p>

<blockquote>
<ul>
<li>Loading meshes with materials from Wavefront OBJ format ( tested with Blender exporter )</li>
</ul>
</blockquote>

<ul>
<li>Loading textures from various image formats ( powered by SOIL )</li>

<li>Compiling vertex, geometry and fragment shaders</li>

<li>Shader system, which supports basic stuff for developing your own shaders ( uniforms, attributes and textures )</li>

<li>Shader library which provides basic shaders</li>

<li>Simple lighting system</li>

<li>Cube and plane meshes</li>

<li>Skyboxes</li>

<li>Keyboard and mouse input</li>

<li>Simple ( yet buggy ) terrain system</li>

<li>Post processing ( WIP )</li>

<li>Object picking</li>

<li>Blender exporter plugin in custom format ( WIP )</li>

<li>2D textures and text rendering</li>

<li>Rigid body dynamics ( powered by Bullet )</li>
</ul>

<p>At last, here are some screenshots and videos:</p>

<h3 id='terrain_demo'>Terrain demo</h3>
<pre class='markdown-html-error' style='border: solid 3px red; background-color: pink'>REXML could not parse this XML/HTML: 
&lt;iframe width=&quot;570&quot; height=&quot;340&quot; src=&quot;//www.youtube.com/embed/FogCR0x93Zg?list=UU1VEk32Dv8l49nlaIclDyAw&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;</pre>
<h3 id='physics_demo'>Physics demo</h3>
<pre class='markdown-html-error' style='border: solid 3px red; background-color: pink'>REXML could not parse this XML/HTML: 
&lt;iframe width=&quot;570&quot; height=&quot;340&quot; src=&quot;//www.youtube.com/embed/xiy6hlL0nYE?list=UU1VEk32Dv8l49nlaIclDyAw&quot; frameborder=&quot;0&quot; allowfullscreen&gt;&lt;/iframe&gt;</pre>
<h3 id='screenshots'>Screenshots</h3>

<p>An effort to write a game</p>

<p><img alt='An effort to write a game' src='/public/pxg-engine-design/gamedev-effort.png' /></p>

<p>Scene loaded from OBJ and skybox</p>

<p><img alt='Scene loaded from OBJ and skybox' src='/public/pxg-engine-design/scene.png' /></p>
</article>

<aside class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/git-newbie-tips.html">
            3 Tips for git newbies
            <small><time datetime="2015-02-20T00:00:00+02:00">20 Feb 2015</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/opengl-learning-resources.html">
            OpenGL learning resources
            <small><time datetime="2014-10-28T00:00:00+02:00">28 Oct 2014</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/brainfuck-programming.html">
            Brainfuck programming
            <small><time datetime="2014-09-28T00:00:00+03:00">28 Sep 2014</time></small>
          </a>
        </h3>
      </li>
    
  </ul>
<!-- Place this tag where you want the share button to render. -->
<div class="g-plus" data-action="share" data-annotation="bubble" data-href="http://rostakagmfun.github.io/pxg-engine-design.html"></div>

<!-- Place this tag after the last share tag. -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/platform.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>

<a class="twitter-share-button"
  href="https://twitter.com/share"
data-via="RostakaGmfun">
Tweet
</a>
<script>
window.twttr=(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);t._e=[];t.ready=function(f){t._e.push(f);};return t;}(document,"script","twitter-wjs"));
</script>

</aside>


<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'rostakagmfun'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
